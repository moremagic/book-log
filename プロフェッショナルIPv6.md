# プロフェッショナル IPv6 読書メモ

## DL
https://professionalipv6.booth.pm/items/913273


# 序文

- IPv6 基本仕様（RFC1883） 1995年発行だがなかなか移行が進まなかった
- 2011年 IPv4 枯渇。急激に移行が進む
- IPv6 のまとまった情報が少なかった
- 多くのエンジニアに向けてまとまった情報を提供することも目指し書かれた

## 混ざりつつも、似て非なるプロトコル

- IPv4と IPv6は全く違うプロトコルで別々のネットワーク
- しかしIPv4とIPv6 は同じ物理回線やサーバを共有するのが一般的
- 一つのインターネットと言う考えから部分的には意図的に（仕様が？）混ざっている
  - DNSなど
- 似て非なる部分を明確にし、平行運用されるデュアルスタック環境についても解説する

## 背景や経緯の説明

- RFCは誰でも読める形で公開されているが背景や経緯についての言及が無いこともある
- RFC を読むだけではわからない部分を補う
- IPv6 は標準化された当初から中身が関わり続けているため背景を知ると理解しやすい

## 無償配布

- PDFを無償配布（CCC:BY-NC-SA）
- IPv6 への情報アクセスを容易にし運用上の問題を防ぎたい

## 本書の構成

（割愛）

# 本書を読むにあたっての前提知識

- インターネットの仕組みとIPv6についておさらい
- IPv4とIPv6が共存するデュアルスタック環境の鍵となるDNSについて解説
- NAT64,DNS64概要を紹介

## 第一章 インターネット概要

- インターネット；ネットワーク同士をつないだもの
- プロトコル（protocol）；相互通信するための送受信の決まり
- IP；インターネットプロトコル
- IPv6；インターネットプロトコル バージョン６
- IPv4 の枯渇を防ぐ： NAT、CIDR、プライベートIP
− IPv6 はIPアドレス空間をオキクして枯渇を解決するよ！

### 1.1 IPはパケット交換技術

- 回線交換方式：片方が通話中は待っていることしかできない
− パケット交換方式；パケットを小さくすることで回線専有時間を短く
- 回線交換方式からパケット交換方式へ
− パケット；小包

#### 1.1.1 IPパケットフォーマット

- パケットのデータを表現する型；フォーマット
- パケットには ヘッダとペイロードがある
- バイトオーダー：ビットの並べ方
  - ビッグエンディアン（MSBから並べる)とリトルエンディアン；ガリバー旅行記
  - MSB；MostSignificantBit　メモリアドレスが大きいほう
  - LSB；LeastSignificantBit　小さい方
  - ネットワークバイトオーダ、ホストバイトオーダー
- 物理層の通り方は決まってない

#### 1.1.2 IPパケットを転送するルータ

- ルータ（route）；IPパケットを転送する機器
- ルータはルーティングテーブルを持つ
- パケットのヘッダに書いてある宛先を見て ルーティングテーブルに従って転送
- それだけで目的地に届くのね

#### 1.1.3 ルータ、ホスト、ノード

- 用語整理
  - ノード：接点。ルータ
  - ホスト: ネットワークの末端。ルーターではないノード（RFC8200)
　
#### 1.1.4 IPアドレスの構成

- IPアドレスの集合体；ネットワーク、サブネット
- ルーティングテーブル；経路情報、サブネット
- IPアドレスの表現
  - IPv4アドレス；前半部を ネットワーク部、後半部を ホスト部
  - IPv6アドレス；前半部を ネットワーク部、後半部を インターフェース識別値
- ネットマスク
  - ビット演算 AND （両方共１だと １）
  - ネットワークアドレスを計算する

#### 1.1.5 プレフィックス長
- 先頭から何ビット１かを表すことでネットワークアドレスを表現する方法

#### 1.1.6 ルーティングテーブルはどのように生成されているか
- フォワーディング；ルータがルーティングテーブルに従ってパケットを転送すること
- トポロジ；ネットワーク構成やネットワーク全体の形状のこと
- デフォルトルータ
  - 標準の通信先。ルータ（ゲートウェイ）のこと
  - デフォルトゲートウェイ

- ルーティングテーブルはどうやって作るか
  - 人間による手作業
  - ルータ同士が協調して自動生成（ルーティングプロトコル）

- ルーティング・プロトコル
  - 各組織内ネットワーク
    - ディスインスペクタ型（ルータが近くにある機器を伝言ゲームで伝える）
      - RIP（RoutingInfomationProtocol): IPv4のみで使用可能
      - RIPng: RIPv2 IPv6拡張版
    - リンクステート型（周囲の機器一覧をすべてのルータと共有する）
      - OSPF(OpenShortestPathFirst)
        - OSPFv2:IPv4；サブネット単位でルーティングテーブルを計算
        - OSPFv3: RFC5340、RFC5838 IPv4,IPVv6両方で使えるようになった
      - IS-IS(IntermediateSystem to Intermediate System)
      - リンクステート型は大規模ネットワークでは現実的ではない
  - 組織間ネットワーク
    - 組織ネットワークを AS（AutonomousSystem）自律システム という単位で管理
    - AS間 の経路制御を行う
    - BGP（BorderGatwayProtocol）
      - BGP4 IPv4用
      - BGP4+（RFC4760） IPv4、IPv6に対応

### 1.2 層に別れるネットワーク

- インターネット階層モデル
  - 4層
    - アプリケーション層
    - トランスポート層
      - TCP, UDP
    - ネットワーク層
      - IP？、ICMP？
    - リンク層
      - ARP？

  - OSI参照モデルとは違うみたい
     - https://ja.wikipedia.org/wiki/OSI%E5%8F%82%E7%85%A7%E3%83%A2%E3%83%87%E3%83%AB

#### 1.2.1 階層構造とパケット

- 各層ごとにパケットが入れ子になってる

#### 1.2.2 イーサネットにおける違い

- IPv4、IPv6の違い
  - トランスポート層ヘッダ；Protocol、NextHeader
  - リンク層ヘッダ；タイプフィールド、マルチキャストアドレス

### 1.3 トランスポート層の役割

- ネットワークはパケットを運ぶだけで到達保証はしない
- トランスポート層（TCP）でパケットの到達保証をする
  - 再送制御、順序保証
  - IPv4、IPv6で同じように使える

- UDP は カスタム用プロトコル
  - プログラマが自分で必要な機能を実装するためのプロトコル
  - TCP みたいに頑張らない

## 1.4 オープンなプロトコルとRFC

- 通信の約束事を決めたのがプロトコル

### 1.4.1 インターネットのプロトコルはオープン

- インターネットを利用した通信プロトコルはすべてオープン

### 1.4.2  オープンな仕様としてのRFC

- TCP/IPについての仕様はIETF（InternetEnginneringTaskForce）で議論されている
- 議論された結果は文書として公開される→ RFC（RequestForComments)

- 規格標準化団体 の違い
  - デジュールスタンダード（法律上の。作る）
    - ITU（InternationalTelecommunicationUnion）国際電気通信連合
    - ISO（InternationalOganaization for Standardization）国際標準
  - デファクトスタンダード（事実上の。議論する）
    - IFTF













    


